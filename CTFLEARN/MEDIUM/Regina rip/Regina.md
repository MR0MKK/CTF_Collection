# Regina!

## Description

* This reversing challenge has been designed to give Ghidra and Ida some headaches! It is written in Assembly language and I hope you find it enjoyable and challenging. Please leave a comment indicating if you used Ghidra / Ida as your main tool or found yourself in gdb to reverse this challenge.
* [Attachement](https://ctflearn.com/challenge/download/1055)

## Solution

Using `DIE` , we found it was ELF file.

        Roma: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=382f49bb7bca7718275924e052bb92c174413641, for GNU/Linux 3.2.0, not stripped
    
Bắt đầu phân tích chương trình thôi!!

![Imgur](https://i.imgur.com/ddcqm9B.png)

Hàm `Sardinia` thực hiện kiểm tra ta có truyền tham số gồm: `flag`, `-v`, `-d`? Nếu có tham số nào thì `return true` cho tham số đó



![Imgur](https://i.imgur.com/SDMFye1.png)

Hàm `Lazio` kiểm tra cú pháp của `flag` gồm: 
>       Bắt đầu bằng "CTFlearn{" và kêt thúc bằng "}"
>       "Tuscany" thay đổi phụ thuộc vào dest[7] == 'm' và dest[13] == 'T'

Hàm `Abruzzo` chỉ phục vụ gợi ý.

Hàm `Lombardi` phục vụ tính giá trị của `Apulia`.

Hmà `Calabria` kiểm tra flag có đúng không. Tập trung dịch ngược ở đây thôi


```
data = [0x759F7518, 0x4E10B5AD, 0x60C0FAA2, 0x43DB8705, 0x1EC87BC1, 0x6CDF0A27, 0x1C0BF02A, 0x6F0A28C6, 0x7C9ED22C, 0x3F106E28, 0x4B13453E, 0x169DA43A, 0x66A975B6, 0x4B1AFFE5, 0x48018B8E, 0x5B59A664, 0x5D45E86D, 0x70BD6A49, 0x13DCA0DB, 0x1E5ECB97, 0x1476CA16, 0x2AC3286F, 0x34B558FF, 0x1EA84816, 0x34F09973, 0x43167939, 0x7A93F5AA, 0x210FC688, 0x0D9BF6AC, 0x23452E20, 0x018477D5, 0x20FF5E37, 0x77D63554, 0x3FD22A74, 0x7D9344CF, 0x4BCC2C9D, 0x47D0A75B, 0x5874B99F, 0x2184F61F, 0x5E0470B1, 0x473D795E, 0x70783C73, 0x1F8EDDEB, 0x0BC6B8C2, 0x03AFBDB7, 0x1E7D62A7, 0x1C7CEC33, 0x273D8E74, 0x1FFFFC9A, 0x5D7F6129, 0x4581EBA2, 0x3C9DFDE2, 0x62B32289, 0x2F6D77EC, 0x623792B1, 0x2CC57D8E, 0x0A85AC46, 0x0B2EB29A, 0x0A3EEC7F, 0x6ED36E08, 0x2CE8F9BA, 0x2D88590E, 0x109049E5, 0x36DD8B51, 0x58109F11, 0x6619D839, 0x033A3A3F, 0x104CD1F2, 0x05171631, 0x4C3168DE, 0x589D0C3F, 0x54B89DBA, 0x66F52FB3, 0x11FDB0A8, 0x5A712858, 0x1ED6AE63, 0x61FC4ABA, 0x02CEE63E, 0x02A828C5, 0x79DF75F4, 0x2E72C6D4, 0x3C2104D8, 0x5600AD3B, 0x099896A6, 0x6ADE1CDC, 0x4F444C51, 0x6F329203, 0x407A677B, 0x685E80B0, 0x334BBC0F, 0x45695BF1, 0x255FBDDF, 0x2FEB0A9F, 0x6017F967, 0x488C8217, 0x3605F9B8, 0x10B9ED5D, 0x622BFB96, 0x23544168, 0x1C191D23, 0x236D23F1, 0x705C43CE, 0x0555CD97, 0x7DE8C334, 0x445FF386, 0x286FD493, 0x3693EDAE, 0x1F2DDC98, 0x189E06D6, 0x4D4B1DCD, 0x56D8A35F, 0x1AFD8600, 0x420601C2, 0x4AA5D4A0, 0x7AC7B356, 0x3D4109E8, 0x7A9B42D3, 0x01CDFC7A, 0x4779A2CE, 0x4081A25C, 0x3BA5A06A, 0x7352CB13, 0x38620D7F, 0x00AF2100, 0x7E0F7001, 0x40E10642, 0x7E4B5670, 0x5F90429B, 0x527F955B, 0x46F3BB5C, 0x1FBDA0E9, 0x7D182CE8, 0x217C2DDF, 0x660D94E4, 0x7AEE31B1, 0x178C72F6, 0x4BE1021A, 0x203BB44D, 0x59C2727E, 0x6FB3009B, 0x596FCF20, 0x1190B6A0, 0x15F39D40, 0x2A8FF716, 0x7FDF6BFC, 0x011B1E23, 0x08478B2E, 0x2A2C92E4, 0x4AC5BB7C, 0x7A233869, 0x171A5293, 0x3C583625, 0x7D09C38F, 0x0411F913, 0x78F41B9B, 0x54A1F1C2, 0x3401000A, 0x4896AA31, 0x3125784D, 0x78470768, 0x591E3446, 0x76431E61, 0x59CDE265, 0x5C4426B5, 0x167F1306, 0x62F4297D, 0x14DB8A98, 0x606A29A1, 0x51E00AF6, 0x44334006, 0x3BA58FD1, 0x6719299C, 0x119D6604, 0x6DD7062E, 0x43A6DD80, 0x54E01E28, 0x7F56B55F, 0x4EA1CFA6, 0x40E1598F, 0x3BA66A74, 0x0822FEAB, 0x3E91E181, 0x15180F3B, 0x739FF507, 0x0E4BAD3D, 0x0F7EA622, 0x29BFDBD1, 0x3799833F, 0x4B22E618, 0x19789617, 0x4894E05E, 0x5FEEC76D, 0x70D5FF34, 0x2EF46444, 0x34263727, 0x31D9BF9B, 0x41582504, 0x3B6BFD7E, 0x7F7B78EA, 0x62C51E81, 0x6E83578E, 0x2FAAD31E, 0x13763BFA, 0x33173551, 0x151E8F82, 0x3D75C0BA, 0x4E4F9A6F, 0x33E13B5D, 0x6268C15F, 0x66865908, 0x6E6E327F, 0x1CA41B9E, 0x03F39F73, 0x1E2E8B0F, 0x0A1EDDD7, 0x5227DE01, 0x2B4E3795, 0x2182B806, 0x372964B7, 0x3615F77B, 0x5803E161, 0x03AEA2D7, 0x4E22DF85, 0x41A0FA65, 0x60CE6B18, 0x29F40103, 0x200B027A, 0x7BF82959, 0x7DFD2B55, 0x4C3E5A13, 0x60FAB4ED, 0x48E9AB3F, 0x54495799, 0x714CC6A0, 0x2BC11A47, 0x402A121D, 0x3CCDC8B8, 0x165A985A, 0x047D5334, 0x0B1BB0A9, 0x0A33DAC4, 0x479F3283, 0x6B05D4AE, 0x107232DA, 0x0D229800, 0x3DF2FB59, 0x0B501DF9, 0x27C3AAC1, 0x67B25862, 0x6587EF7F, 0x0AD0A182, 0x4125BF8C, 0x1CC12F2C, 0x6E8DD3EF, 0x68DD895C, 0x449FE4DE]
Apulia = [0x759F7565, 0x4E10B5F6, 0x60C0FAF7, 0x43DB873E, 0x1EC87C13, 0x6CDF0A8E, 0x1C0BF080, 0x6F0A293F, 0x7C9ED25F, 0x3F106E5B, 0x4B1345B8, 0x169DA4AA, 0x66A9761C, 0x4B1B0053, 0x48018BD4, 0x5B59A6DD, 0x5D45E8D0, 0x70BD6A98, 0x13DCA11F, 0x1E5ECC00, 0x1476CA83, 0x2AC328B2, 0x34B55968, 0x1EA84865, 0x34F099B3, 0x431679AF, 0x7A93F5FE, 0x210FC6DB, 0x0D9BF71C, 0x23452E6C, 0x01847832, 0x20FF5E82, 0x77D63584, 0x3FD22AC6, 0x7D93453E, 0x4BCC2D12, 0x47D0A794, 0x5874B9F3, 0x2184F665, 0x5E0470D5, 0x473D79CA, 0x70783CC7, 0x1F8EDE19, 0x0BC6B936, 0x03AFBE2C, 0x1E7D62EB, 0x1C7CEC9C, 0x273D8ED8, 0x1FFFFCE1, 0x5D7F6174, 0x4581EC19, 0x3C9DFE13, 0x62B322D6, 0x2F6D784D, 0x623792E8, 0x2CC57E00, 0x0A85AC95, 0x0B2EB30D, 0x0A3EECF2, 0x6ED36E3A, 0x2CE8FA0F, 0x2D885943, 0x10904A5A, 0x36DD8B9C, 0x58109F7C, 0x6619D88E, 0x033A3A86, 0x104CD226, 0x0517169D, 0x4C316910, 0x589D0CAF, 0x54B89DF0, 0x66F52FE7, 0x11FDB0D9, 0x5A7128D2, 0x1ED6AEA7, 0x61FC4AEA, 0x02CEE6AF, 0x02A8290F, 0x79DF764A, 0x2E72C718, 0x3C210546, 0x5600AD9F, 0x099896FB, 0x6ADE1D29, 0x4F444C9C, 0x6F329279, 0x407A67CF, 0x685E8102, 0x334BBC81, 0x45695C21, 0x255FBE24, 0x2FEB0AEA, 0x6017F9DC, 0x488C828E, 0x3605FA2B, 0x10B9EDBF, 0x622BFBCE, 0x2354419F, 0x1C191D7D, 0x236D2450, 0x705C4437, 0x0555CDE5, 0x7DE8C37C, 0x445FF400, 0x286FD50A, 0x3693EE0D, 0x1F2DDCCA, 0x189E074B, 0x4D4B1E1F, 0x56D8A3B5, 0x1AFD864C, 0x42060213, 0x4AA5D4E7, 0x7AC7B3CD, 0x3D410A5F, 0x7A9B434C, 0x01CDFCBC, 0x4779A2F1, 0x4081A2C8, 0x3BA5A0D1, 0x7352CB43, 0x38620DF9, 0x00AF2153, 0x7E0F7047, 0x40E1066C, 0x7E4B56B7, 0x5F904305, 0x527F958B, 0x46F3BBD0, 0x1FBDA11E, 0x7D182D42, 0x217C2E39, 0x660D953C, 0x7AEE31F8, 0x178C734E, 0x4BE10261, 0x203BB475, 0x59C272F3, 0x6FB300D4, 0x596FCF92, 0x1190B718, 0x15F39DA6, 0x2A8FF765, 0x7FDF6C4E, 0x011B1E5B, 0x08478B99, 0x2A2C9314, 0x4AC5BBC6, 0x7A2338C2, 0x171A52D8, 0x3C583686, 0x7D09C406, 0x0411F949, 0x78F41C03, 0x54A1F231, 0x34010077, 0x4896AAA2, 0x312578B8, 0x784707BF, 0x591E34B1, 0x76431ED7, 0x59CDE2D3, 0x5C442727, 0x167F1339, 0x62F429B4, 0x14DB8AEF, 0x606A29E8, 0x51E00B40, 0x4433404A, 0x3BA5903B, 0x671929CD, 0x119D666B, 0x6DD70675, 0x43A6DDD2, 0x54E01E8E, 0x7F56B594, 0x4EA1CFEF, 0x40E159C7, 0x3BA66ADD, 0x0822FF10, 0x3E91E1CF, 0x15180F9A, 0x739FF56C, 0x0E4BAD81, 0x0F7EA68D, 0x29BFDC1B, 0x3799838A, 0x4B22E685, 0x19789679, 0x4894E0AF, 0x5FEEC7E1, 0x70D5FFA2, 0x2EF464A3, 0x34263779, 0x31D9BFCB, 0x41582553, 0x3B6BFDEF, 0x7F7B7957, 0x62C51EB9, 0x6E8357F1, 0x2FAAD388, 0x13763C32, 0x33173594, 0x151E8FC6, 0x3D75C114, 0x4E4F9ABF, 0x33E13BCD, 0x6268C1B0, 0x66865950, 0x6E6E32BC, 0x1CA41C0C, 0x03F39FCC, 0x1E2E8B72, 0x0A1EDE3C, 0x5227DE33, 0x2B4E37E7, 0x2182B86A, 0x372964FE, 0x3615F7E8, 0x5803E1AB, 0x03AEA310, 0x4E22DFF6, 0x41A0FAAB, 0x60CE6B63, 0x29F40173, 0x200B02C2, 0x7BF829C8, 0x7DFD2BA5, 0x4C3E5A62, 0x60FAB566, 0x48E9AB8D, 0x544957F3, 0x714CC70F, 0x2BC11AB2, 0x402A128D, 0x3CCDC917, 0x165A98CE, 0x047D5366, 0x0B1BB10E, 0x0A33DAFA, 0x479F32CC, 0x6B05D4E6, 0x1072333D, 0x0D22985F, 0x3DF2FBA0, 0x0B501E3A, 0x27C3AB18, 0x67B258DB, 0x6587EFD8, 0x0AD0A1F9, 0x4125C005, 0x1CC12F71, 0x6E8DD43A, 0x68DD89A2, 0x449FE545]
count = 0
flag = "CTFlearn{"
for i in range(20):
    for input_value in range(0x20,0x7F):
        v14 = (((data[i])  % (input_value + input_value * input_value * (input_value * (37 * input_value + 23) + 9) + 37))&0xFF)
        v15 = Apulia[v14]
        v16 = data[v14]
        if v16 < v15:
            v12 = ((v15 - v16))
        else:
            v12 = ((v16 - v15))
        if input_value == v12:
            flag+=chr(v12)
            if i == 19:
                flag+='}'
        count = count + 1
    
print(flag)

```
* Flag:

```
CTFlearn{K1ng_R0mulus_Of_R0ma}
```